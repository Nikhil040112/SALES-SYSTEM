{% extends "base.html" %}
{% block title %}My Leads - Sales Pro{% endblock %}

{% block content %}
<div style="max-width: 1120px; margin: 0 auto; padding: 8px 0 24px;">

  <!-- Heading -->
  <div style="margin-bottom:16px;">
    <div style="font-size:22px;font-weight:800;letter-spacing:-0.02em;">
      My leads
      <span style="
        display:inline-block;
        margin-left:8px;
        padding:2px 8px;
        border-radius:999px;
        background:#eef2ff;
        font-size:11px;
        font-weight:600;
        color:#4b5563;
      ">
        Assigned to you
      </span>
    </div>
    <p style="margin:4px 0 0;font-size:13px;color:#6b7280;">
      View all leads assigned to you and jump straight to logging the first call.
    </p>
  </div>

  <!-- Card -->
  <div style="
    background:#ffffff;
    border-radius:16px;
    border:1px solid #e5e7eb;
    box-shadow:0 10px 30px rgba(15,23,42,0.08);
  ">
    <div style="padding:12px 16px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-weight:700;font-size:15px;">Lead list</div>
        <div style="font-size:12px;color:#6b7280;">Click a lead to open the call form preâ€‘filled with their details.</div>
      </div>
      <button
        onclick="loadLeads()"
        style="
          border:none;
          padding:6px 12px;
          border-radius:999px;
          background:#2563eb;
          color:#ffffff;
          font-size:12px;
          font-weight:600;
          cursor:pointer;
        "
      >
        Refresh
      </button>
    </div>

    <div id="emptyState" style="display:none;text-align:center;padding:32px 16px;">
      <div style="font-size:32px;margin-bottom:8px;">ðŸ“­</div>
      <div style="font-size:15px;font-weight:700;margin-bottom:4px;">No new leads</div>
      <div style="font-size:13px;color:#6b7280;max-width:320px;margin:0 auto;">
        Leads assigned to you will appear here automatically.
      </div>
    </div>

    <div id="listWrapper" style="max-height:420px;overflow-y:auto;padding:6px 0;">
      <ul id="leads" style="list-style:none;margin:0;padding:0;"></ul>
    </div>
  </div>
</div>

<style>
.lead-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 12px;
  border-bottom:1px solid #f3f4f6;
  font-size:13px;
  cursor:pointer;
  transition:background .2s ease, transform .2s ease;
}
.lead-item:last-child{
  border-bottom:none;
}
.lead-item:hover{
  background:#f3f4ff;
  transform:translateX(4px);
}
.lead-main{
  display:flex;
  flex-direction:column;
}
.lead-title{
  font-weight:600;
  color:#111827;
}
.lead-sub{
  font-size:11px;
  color:#6b7280;
}
.lead-meta{
  font-size:11px;
  color:#6b7280;
  text-align:right;
}
</style>

<script>
function headers() {
  return {
    "Authorization": "Bearer " + localStorage.getItem("token"),
    "Content-Type": "application/json"
  };
}

/* LOAD LEADS */
async function loadLeads() {
  const res = await fetch("/leads/my", { headers: headers() });

  if (res.status === 401) {
    window.location.href = "/login";
    return;
  }
  if (!res.ok) return;

  const data = await res.json();
  const ul = document.getElementById("leads");
  const emptyState = document.getElementById("emptyState");
  const listWrapper = document.getElementById("listWrapper");

  ul.innerHTML = "";

  if (!Array.isArray(data) || !data.length) {
    emptyState.style.display = "block";
    listWrapper.style.display = "none";
    return;
  }

  emptyState.style.display = "none";
  listWrapper.style.display = "block";

  data.forEach(function (l) {
    const li = document.createElement("li");
    li.className = "lead-item";

    li.innerHTML =
      '<div class="lead-main">' +
        '<span class="lead-title">' + (l.client_name || "") + '</span>' +
        '<span class="lead-sub">' + (l.query_source || "Unknown source") + '</span>' +
      '</div>' +
      '<div class="lead-meta">' +
        (l.contact_number || "") +
      '</div>';

    li.onclick = function () {
      window.location.href = "/call-details?lead_id=" + l.id;
    };

    ul.appendChild(li);
  });
}

loadLeads();
</script>
{% endblock %}