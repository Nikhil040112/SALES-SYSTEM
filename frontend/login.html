{% extends "base.html" %}
{% block title %}Login - Sales Pro{% endblock %}

{% block content %}
<div style="
  max-width: 420px;
  margin: 40px auto;
  padding: 8px 0 24px;
">

  <div style="
    background:#ffffff;
    border-radius:20px;
    border:1px solid #e5e7eb;
    box-shadow:0 12px 32px rgba(15,23,42,0.12);
    padding:20px 22px 18px;
  ">
    <div style="margin-bottom:14px;">
      <div style="font-size:20px;font-weight:800;letter-spacing:-0.02em;">Sign in</div>
      <div style="font-size:12px;color:#6b7280;margin-top:2px;">
        Access your sales workspace with your email and password.
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:10px;">
      <div>
        <label style="display:block;font-size:12px;font-weight:600;color:#4b5563;margin-bottom:3px;">
          Email
        </label>
        <input id="email" placeholder="you@example.com" style="
          width:100%;
          padding:8px 10px;
          border-radius:10px;
          border:1px solid #e5e7eb;
          font-size:13px;
        ">
      </div>

      <div>
        <label style="display:block;font-size:12px;font-weight:600;color:#4b5563;margin-bottom:3px;">
          Password
        </label>
        <input id="password" type="password" placeholder="••••••••" style="
          width:100%;
          padding:8px 10px;
          border-radius:10px;
          border:1px solid #e5e7eb;
          font-size:13px;
        ">
      </div>

      <p id="error" style="min-height:16px;font-size:12px;color:#b91c1c;margin:2px 0 0;"></p>

      <button
        onclick="login()"
        style="
          margin-top:4px;
          width:100%;
          border:none;
          padding:8px 16px;
          border-radius:999px;
          background:#2563eb;
          color:#ffffff;
          font-size:13px;
          font-weight:600;
          cursor:pointer;
        "
      >
        Login
      </button>
    </div>

    <p style="margin-top: 14px; font-size: 12px; color:#6b7280;">
      New here?
      <a href="/register" style="color:#2563eb;font-weight:600;text-decoration:none;">
        Register as salesperson
      </a>
    </p>
  </div>
</div>

<script>
async function login() {
  const emailVal = document.getElementById("email").value.trim();
  const passwordVal = document.getElementById("password").value;
  const errorEl = document.getElementById("error");

  errorEl.textContent = "";

  if (!emailVal || !passwordVal) {
    errorEl.textContent = "Please enter email and password.";
    return;
  }

  try {
    const res = await fetch("/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: emailVal, password: passwordVal })
    });

    if (!res.ok) {
      errorEl.textContent = "Invalid credentials. Please try again.";
      return;
    }

    const data = await res.json();
    localStorage.setItem("token", data.access_token);
    localStorage.setItem("role", data.role);

    window.location.href = data.role === "ADMIN" ? "/admin" : "/dashboard";
  } catch (e) {
    errorEl.textContent = "Network error. Please try again.";
  }
}
</script>
{% endblock %}